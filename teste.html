<!DOCTYPE html>
<html>
<head>
    <title>Capturar e Transcrever Áudio</title>
</head>
<body>
    <button id="startButton">Iniciar Gravação</button>
    <button id="stopButton" disabled>Parar Gravação</button>
    <p id="transcription"></p>
    <p id="error" style="color: red;"></p>

    <script>
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const transcriptionElement = document.getElementById('transcription');
        const errorElement = document.getElementById('error');

        let mediaRecorder;
        let recognition;
        let isRecording = false;

        // Verificar se a Web Speech API é suportada
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            recognition = new (window.webkitSpeechRecognition || window.SpeechRecognition)();
            recognition.continuous = true; // Manter a escuta ativa
            recognition.interimResults = true; // Mostrar resultados parciais

            recognition.onstart = () => {
                transcriptionElement.textContent = 'Gravando...';
                errorElement.textContent = '';
                startButton.disabled = true;
                stopButton.disabled = false;
                isRecording = true;
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript + ' ';
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }

                transcriptionElement.textContent = finalTranscript + interimTranscript;
            };

            recognition.onerror = (event) => {
                console.error('Erro de reconhecimento de fala:', event.error);
                errorElement.textContent = `Erro de reconhecimento: ${event.error}`;
                stopRecording();
            };

            recognition.onend = () => {
                if (isRecording) {
                    transcriptionElement.textContent += ' (Parou de gravar)';
                    stopRecording();
                }
            };
        } else {
            errorElement.textContent = 'A Web Speech API não é suportada neste navegador.';
            startButton.disabled = true;
            stopButton.disabled = true;
        }

        startButton.addEventListener('click', () => {
            if (recognition) {
                recognition.start();
            }
        });

        stopButton.addEventListener('click', () => {
            stopRecording();
        });

        function stopRecording() {
            if (recognition && isRecording) {
                recognition.stop();
                startButton.disabled = false;
                stopButton.disabled = true;
                isRecording = false;
            }
        }
    </script>
</body>
</html>